#!/bin/bash
###################################################
#              Recon Script
#
# Version: v2_08102016
# Created By: Seclyn
# Description: For initial recon of network/hosts.
# Mod by: r00t.pgp, mrcopy
#
###################################################
#             Set Variables
#         workdir=~/Dropbox/Hack\ The\ Box/hackthebox
#
###################################################
clear

# Select IP to Target
tput setaf 4; echo Enter The IP Of The Target:
tput setaf 7;
echo --------------------------------------------
read ip
echo Making folder structure for $ip
mkdir $ip && mkdir $ip/exploits && mkdir $ip/scans
cd $ip
echo Done
echo

# Masscan rate=100
tput setaf 2;
echo --------------------------------------------
echo Running masscan rate=100 - Host $ip
tput setaf 7;
echo **Masscan**
masscan --rate=100 -e tun0 -p1-65535 $ip -oG scans/masscan-heavy.scan
echo

# Quick Nmap Scan To Get You Started
tput setaf 1;
echo --------------------------------------------
echo Running light nmap scan of top 20 ports  - Host $ip
tput setaf 7;
echo **TCP SCAN**
nmap -vv -open --top-ports=20 -sV -Pn -n -T4 -oN scans/nmap-top-20-ports.nmap --stats-every 10s $ip
echo

# RPC, NBT Scan
tput setaf 2;
echo ------------------------
echo Running RPC and NBT scan
tput setaf 7;
sleep 10
echo Checking For RPC and NBT Services . . .
if grep "msrpc" scans/nmap-top-20-ports.nmap; then
        nmap --script msrpc-enum --script-args vulns.showall $ip -oN scans/nmap-msrpc.txt
        echo MSRPC and NBT results stored in scans/nmap-msrpc.txt
else
        echo No MSRPC Services Found on $ip
fi
echo

# SMB Enum
tput setaf 2;
echo -----------------------------------------------------
echo Running enum4linux scan. Output to scans/smb-enum4linux.txt
tput setaf 7;
sleep 10
echo Checking For SMB Services . . . .
if grep "smb" scans/nmap-top-20-ports.nmap; then
	echo **SMB Scanning..**
	enum4linux $ip > scans/smb-enum4linux.txt
	echo SMB Enum stored in scans/smb-enum4linux.txt
	nmap --script smb-* --script-args vulns.showall $ip -oN scans/nmap-smb.txt
else
	echo No SMB Services Found on $ip
fi
echo

# FTP Enum
tput setaf 2;
echo ------------------------------------------------
echo Running Nmap ftp scan. Output to scans/nmap-ftp.txt
tput setaf 7;
sleep 10
echo Checking For FTP Services . . . .
if grep "ftp" scans/nmap-top-20-ports.nmap; then
	echo **NMAP FTP Scan**
        nmap $ip --script ftp-* -oN scans/nmap-ftp.txt
        echo FTP Enum stored in scans/nmap-ftp.txt
else
        echo No FTP  Services Found on $ip
fi
echo

# SSH Enum
tput setaf 2;
echo -------------------------------------------------
echo Running Nmap SSH scan. Output to scans/nmap-ssh.txt
tput setaf 7;
sleep 10
echo Checking For SSH Services . . . .
if grep "ssh" scans/nmap-top-20-ports.nmap; then
	echo **NMAP SSH Scan**
        nmap $ip --script ssh-*,ssl-* -oN scans/nmap-ssh.txt
        echo SSH Enum stored in scans/nmap-ssh.txt
else
        echo No SSH  Services Found on $ip
fi
echo

# SNMP Enum
tput setaf 2;
echo ----------------------------------------------
echo Running SNMP scan. Output to scans/nmap-snmp.txt
sleep 10
tput setaf 7;
echo Checking For SNMP Services . . . .
if grep "snmp" scans/nmap-top-20-ports.nmap; then
	echo **NMAP SNMP Scan**
        nmap $ip --script snmp-* -oN scans/nmap-snmp.txt
        echo SSH Enum stored in scans/nmap-snmp.txt
else
        echo No SNMP  Services Found on $ip
fi
echo

# DNS Enum
tput setaf 2;
echo --------------------------------------------
echo Running DNS scan. Output to scans/nmap-dns.txt
sleep 10
tput setaf 7;
echo Checking For DNS Services . . . .
if grep "ssh" scans/nmap-top-20-ports.nmap; then
	echo **NMAP DNS Scan**
        nmap $ip --script dns-zone-transfer,dns-srv-enum -oN scans/nmap-dns.txt
        echo DNS Enum stored in scans/nmap-dns.txt
else
        echo No DNS Services Found on $ip
fi
echo

# MSSQL Enum
tput setaf 2;
echo -------------------
echo Running MS SQL scan
sleep 10
tput setaf 7;
echo Checking For MS SQL Services . . . .
if grep ms-sql* scans/nmap-top-20-ports.nmap; then
	echo **NMAP MS-SQL Scan**
        nmap --script ms-sql-* --script-args vulns.showall $ip -oN scans/nmap-mssql.txt
        echo MS-SQL Enum stored in scans/nmap-mssql.txt
else
        echo No MS-SQL Services Found on $ip
fi
echo

tput setaf 2;
echo ###################################################################
echo # Last SCAN!!! Nikto, Fetch robots.txt, NMAP HTTP
echo ###################################################################
sleep 10
echo Checking For HTTP Services . . . .
if grep "80/tcp" scans/nmap-top-20-ports.nmap; then
tput setaf 7;
	echo **Running nikto scan, press CTRL-C to Skip**
	nikto -h $ip > scans/nikto.txt #-ask no
        echo Niko output stored in scans/nikto.txt
	echo **Fething robots.txt file**
	wget http://$ip/robots.txt -O robots.txt
	echo **Running nmap http scan**
	nmap $ip -sV --script "http-sitemap-gen*,http-methods,http-mobile*, \
		http-open*,http-sql*,http-userdir*,http-vhosts,http-webdav*, \
		http-iis-webdav*,http-enum*,http-frontpage*, \
		http-useragent*" -oN scans/nmap-http
	echo Nmap HTTP Enum stored in scans/nmap-http 
else
	echo No HTTP Services Found On $ip
fi
echo

echo Scan completed for $ip
echo Happy Hunting!
echo ------------------------
echo
ls -lth
#end
